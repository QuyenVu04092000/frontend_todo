(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(6906)}])},6906:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var a=r(5893),s=r(7294),l=r(887),n=r(1163),i=r(4279),d=e=>{let{id:t,title:r,subtitle:s,accentClass:n="text-gray-500",children:i}=e,{setNodeRef:d,isOver:o}=(0,l.Zj)({id:t});return(0,a.jsxs)("section",{ref:d,className:"flex flex-col gap-4 rounded-2xl bg-white p-4 shadow transition ".concat(o?"ring-2 ring-brand-500/70":"ring-1 ring-gray-100"),children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-widest ".concat(n),children:r}),s&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:s})]}),(0,a.jsx)("div",{className:"flex flex-1 flex-col gap-3",children:i})]})},o=r(4285);let c=e=>{if(!e)return"";let t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},u=e=>{if(!e)return"-";let t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString()},m=["TODO","IN_PROGRESS","DONE"],x=e=>{let t=m.indexOf(e);return -1===t||t===m.length-1?null:m[t+1]};var p=e=>{var t;let{todo:r,onUpdateStatus:n,onViewDetails:d,onToggleSubTodo:c,onDeleteTodo:m,onDeleteSubTodo:p}=e,{attributes:g,listeners:b,setNodeRef:h,transform:f,isDragging:y}=(0,l.O1)({id:r.id,data:{todo:r}}),v={transform:f?o.ux.Translate.toString(f):void 0,opacity:y?.6:1,transition:y?"none":"transform 220ms cubic-bezier(0.25, 0.8, 0.25, 1)"},w=null!==(t=r.subtodos)&&void 0!==t?t:[],N=(0,s.useMemo)(()=>w.filter(e=>"DONE"===e.status).length,[w]);x(r.status);let j=(0,s.useMemo)(()=>r.imageUrl?r.imageUrl.startsWith("http://")||r.imageUrl.startsWith("https://")?r.imageUrl:"".concat(i.T5).concat(r.imageUrl):null,[r.imageUrl]);return(0,a.jsxs)("article",{ref:h,style:v,...g,...b,className:"group flex cursor-grab flex-col gap-3 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm transition-all duration-200 ease-out hover:-translate-y-1 hover:shadow-xl active:cursor-grabbing",children:[(0,a.jsxs)("header",{className:"flex items-start justify-between gap-2",children:[(0,a.jsx)("div",{className:"space-y-1",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r.title})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>d(r),className:"rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"Details"}),(0,a.jsx)("button",{type:"button",onClick:()=>{m(r).catch(()=>{})},className:"rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"})]})]}),(0,a.jsxs)("select",{value:r.status,onChange:e=>n(r,e.target.value),className:"rounded border border-transparent outline outline-gray-300 px-4 py-1 text-sm focus-visible:ring-brand-500/30",children:[(0,a.jsx)("option",{value:"TODO",children:"Chưa l\xe0m"}),(0,a.jsx)("option",{value:"IN_PROGRESS",children:"Đang l\xe0m"}),(0,a.jsx)("option",{value:"DONE",children:"Đ\xe3 l\xe0m"})]}),r.description&&(0,a.jsx)("p",{className:"line-clamp-3 text-sm text-gray-600",children:r.description}),j&&(0,a.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,a.jsx)("img",{src:j,alt:"".concat(r.title," reference"),className:"h-36 w-full object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]",loading:"lazy"})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs text-gray-500",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold uppercase tracking-wider text-gray-400",children:"Start"}),(0,a.jsx)("p",{children:r.startDate?u(r.startDate):"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold uppercase tracking-wider text-gray-400",children:"End"}),(0,a.jsx)("p",{children:r.endDate?u(r.endDate):"-"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-400",children:"Subtodos"}),0===w.length?(0,a.jsx)("p",{className:"rounded-xl border border-dashed border-gray-200 bg-gray-50 px-3 py-2 text-xs text-gray-500",children:"No subtodos yet."}):(0,a.jsx)("ul",{className:"space-y-2",children:w.map(e=>{let t="DONE"===e.status;return(0,a.jsxs)("li",{className:"flex items-start gap-2 rounded-xl border border-gray-100 bg-gray-50/70 px-3 py-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500",checked:t,onChange:t=>c(e,t.target.checked)}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("p",{className:"font-medium ".concat(t?"text-gray-500 line-through":"text-gray-700"),children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-[11px] text-gray-500",children:e.description})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{p(e).catch(()=>{})},className:"rounded-full border border-gray-200 px-2 py-1 text-[10px] font-semibold uppercase tracking-wide text-gray-500 transition hover:border-red-400 hover:text-red-500","aria-label":"Delete ".concat(e.title),children:"Delete"})]},e.id)})})]}),(0,a.jsxs)("footer",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,a.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-[10px] font-semibold uppercase tracking-wide ".concat("DONE"===r.status?"bg-green-100 text-green-700":"IN_PROGRESS"===r.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"),children:r.status.replace("_"," ")}),w.length>0&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-[10px] font-medium uppercase tracking-wide text-gray-600",children:[(0,a.jsx)("span",{role:"img","aria-hidden":"true",children:"\uD83E\uDDE9"}),N,"/",w.length]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:"DONE"===r.status&&w.length>0&&(0,a.jsx)("button",{type:"button",onClick:async()=>{await Promise.all(w.map(e=>c(e,!0)))},className:"rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"Mark subtodos done"})})]})]})};function g(e){var t,r,l,n,d;let{todo:o,onClose:u,onUpdateStatus:m,onCreateSubTodo:x,onToggleSubTodo:p,onDeleteTodo:g,onDeleteSubTodo:b,onUpdateDetails:h,onUpdateTimeline:f}=e,y=(0,s.useMemo)(()=>new Date(o.createdAt).toLocaleString(),[o.createdAt]),v=o.imageUrl?o.imageUrl.startsWith("http")?o.imageUrl:"".concat(i.T5).concat(o.imageUrl):null,[w,N]=(0,s.useState)(""),[j,D]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[k,O]=(0,s.useState)(null),[C,T]=(0,s.useState)(c(o.startDate)),[I,A]=(0,s.useState)(c(o.endDate)),[_,U]=(0,s.useState)(!1),[L,F]=(0,s.useState)(null),[R,P]=(0,s.useState)(null),[J,q]=(0,s.useState)(o.title),[M,z]=(0,s.useState)(null!==(l=o.description)&&void 0!==l?l:""),[G,V]=(0,s.useState)(!1),[W,B]=(0,s.useState)(null),[X,Y]=(0,s.useState)(null);(0,s.useEffect)(()=>{var e;q(o.title),z(null!==(e=o.description)&&void 0!==e?e:""),B(null),Y(null),T(c(o.startDate)),A(c(o.endDate)),F(null),P(null)},[o.description,o.endDate,o.id,o.startDate,o.title]);let H=async(e,t)=>{await p(e,t)},K=async e=>{O(null);try{await b(e)}catch(e){O(e instanceof Error?e.message:"Failed to delete subtodo")}},Z=async()=>{try{await g(o),u()}catch(e){O(e instanceof Error?e.message:"Failed to delete todo")}},Q=async e=>{var t;e.preventDefault();let r=J.trim(),a=M.trim();if(!r){B("Title is required"),Y(null);return}let s=(null!==(t=o.description)&&void 0!==t?t:"").trim();if(r===o.title&&a===s){B(null),Y("No changes to save");return}V(!0),B(null),Y(null);try{await h(o,{title:r,description:a||null}),q(r),z(a),Y("Todo details updated")}catch(e){B(e instanceof Error?e.message:"Failed to update todo")}finally{V(!1)}},$=async e=>{e.preventDefault(),U(!0),F(null),P(null);try{await f(o,{startDate:C||null,endDate:I||null}),P("Timeline updated")}catch(e){F(e instanceof Error?e.message:"Failed to update timeline")}U(!1)},ee=async e=>{if(e.preventDefault(),!w.trim()){O("Subtodo title is required");return}E(!0),O(null);try{await x(o,{title:w.trim(),description:j.trim()||void 0}),N(""),D("")}catch(e){O(e instanceof Error?e.message:"Failed to create subtodo")}finally{E(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,a.jsxs)("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl bg-white shadow-xl",children:[(0,a.jsxs)("header",{className:"flex items-start justify-between gap-4 border-b border-gray-200 p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Todo Detail"}),(0,a.jsx)("h2",{className:"mt-1 text-2xl font-semibold text-gray-900",children:o.title}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Created at: ",y]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:Z,className:"rounded-full border border-red-200 px-3 py-1 text-sm font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"}),(0,a.jsx)("button",{type:"button",onClick:u,className:"rounded-full border border-gray-300 px-3 py-1 text-sm text-gray-500 transition hover:bg-gray-100",children:"Close"})]})]}),(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Edit details"}),(0,a.jsxs)("form",{onSubmit:Q,className:"mt-3 space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",htmlFor:"todo-title",children:"Title"}),(0,a.jsx)("input",{id:"todo-title",type:"text",value:J,onChange:e=>{q(e.target.value),B(null),Y(null)},disabled:G,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-70",placeholder:"Project kickoff"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",htmlFor:"todo-description",children:"Description"}),(0,a.jsx)("textarea",{id:"todo-description",value:M,onChange:e=>{z(e.target.value),B(null),Y(null)},disabled:G,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-70",rows:4,placeholder:"Context, goals, links..."})]}),(W||X)&&(0,a.jsx)("p",{className:"text-sm ".concat(W?"text-red-600":"text-emerald-600"),children:null!=W?W:X}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:G,className:"inline-flex items-center rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:G?"Saving…":"Save changes"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;q(o.title),z(null!==(e=o.description)&&void 0!==e?e:""),B(null),Y(null)},disabled:G,className:"rounded-full border border-gray-300 px-4 py-2 text-xs font-medium text-gray-600 transition hover:border-brand-500 hover:text-brand-500 disabled:cursor-not-allowed disabled:opacity-70",children:"Reset"})]})]})]}),v&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Attached image"}),(0,a.jsx)("img",{src:v,alt:o.title,className:"mt-3 w-full rounded-lg object-cover shadow"})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Status"}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-[10px] font-semibold uppercase tracking-wide ".concat("DONE"===o.status?"bg-green-100 text-green-700":"IN_PROGRESS"===o.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"),children:o.status.replace("_"," ")})})]}),(0,a.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Timeline"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Set the planned start and end dates for this todo."}),(0,a.jsxs)("form",{onSubmit:$,className:"mt-3 grid gap-3 md:grid-cols-2",children:[(0,a.jsxs)("label",{className:"grid gap-1 text-xs font-semibold uppercase tracking-wide text-gray-500",children:["Start date",(0,a.jsx)("input",{type:"date",value:C,onChange:e=>{T(e.target.value),F(null),P(null)},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",disabled:_})]}),(0,a.jsxs)("label",{className:"grid gap-1 text-xs font-semibold uppercase tracking-wide text-gray-500",children:["End date",(0,a.jsx)("input",{type:"date",value:I,onChange:e=>{A(e.target.value),F(null),P(null)},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",disabled:_})]}),(0,a.jsxs)("div",{className:"col-span-full flex flex-col gap-2 text-sm",children:[L&&(0,a.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-red-600",children:L}),R&&(0,a.jsx)("p",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-emerald-600",children:R}),(0,a.jsx)("button",{type:"submit",disabled:_,className:"self-start rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:_?"Saving…":"Save timeline"})]})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["SubTodos (",null!==(n=null===(t=o.subtodos)||void 0===t?void 0:t.length)&&void 0!==n?n:0,")"]})}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:0===(null!==(d=o.subtodos)&&void 0!==d?d:[]).length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No subtodos yet."}):null===(r=o.subtodos)||void 0===r?void 0:r.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-gray-200 bg-gray-50 p-3",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500",checked:"DONE"===e.status,onChange:t=>H(e,t.target.checked)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat("DONE"===e.status?"text-green-600 line-through":"text-gray-700"),children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{K(e)},className:"rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"})]},e.id))}),(0,a.jsxs)("form",{className:"mt-4 space-y-3 rounded-lg border border-dashed border-gray-300 bg-gray-50 p-3",onSubmit:ee,children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Add Subtodo"})}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),placeholder:"Subtodo title",className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30"}),(0,a.jsx)("textarea",{value:j,onChange:e=>D(e.target.value),placeholder:"Optional description",className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",rows:2})]}),k&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:k}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:S,className:"inline-flex items-center justify-center rounded-md bg-brand-500 px-3 py-1 text-sm font-semibold text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:S?"Adding...":"Add Subtodo"})})]})]})]})]})})}let b="todo_offline_queue_v1",h=()=>{try{let e=window.localStorage.getItem(b);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("Failed to read offline queue",e),[]}},f=e=>{if(!e.length){window.localStorage.removeItem(b);return}window.localStorage.setItem(b,JSON.stringify(e))},y=e=>{let t=h();t.push(e),f(t)},v=()=>{let e=h();return f([]),e},w=e=>{f(e)};var N=r(9079);let j={title:"",description:"",startDate:"",endDate:"",image:null},D="todo_cached_todos_v1",S=[{id:"TODO",title:"Todo",accentClass:"text-gray-500"},{id:"IN_PROGRESS",title:"In Progress",accentClass:"text-yellow-600"},{id:"DONE",title:"Done",accentClass:"text-green-600"}],E=e=>e.map(e=>({...e,subtodos:e.subtodos?E(e.subtodos):e.subtodos})),k=(e,t)=>e.filter(e=>e.id!==t).map(e=>({...e,subtodos:e.subtodos?k(e.subtodos,t):e.subtodos})),O=(e,t,r)=>e.map(e=>{var a,s;return e.id===t?{...e,subtodos:[...null!==(s=e.subtodos)&&void 0!==s?s:[],r]}:(null===(a=e.subtodos)||void 0===a?void 0:a.length)?{...e,subtodos:O(e.subtodos,t,r)}:e}),C=(e,t)=>e.map(e=>{var r;return e.id===t.id?t:(null===(r=e.subtodos)||void 0===r?void 0:r.length)?{...e,subtodos:C(e.subtodos,t)}:e}),T=(e,t,r)=>e.map(e=>{var a,s;if(e.id===t){let t="DONE"===r?null===(s=e.subtodos)||void 0===s?void 0:s.map(e=>({...e,status:"DONE"})):e.subtodos;return{...e,status:r,subtodos:t}}return(null===(a=e.subtodos)||void 0===a?void 0:a.some(e=>e.id===t))?{...e,subtodos:e.subtodos.map(e=>e.id===t?{...e,status:r}:e)}:e}),I=(e,t,r)=>e.map(e=>{var a;return e.id===t?{...e,...r}:(null===(a=e.subtodos)||void 0===a?void 0:a.length)?{...e,subtodos:I(e.subtodos,t,r)}:e}),A="todo_status_queue_v1",_=e=>!navigator.onLine||e instanceof TypeError&&"Failed to fetch"===e.message,U=(e,t)=>{let r=new FormData;if(void 0!==e.title&&r.append("title",e.title),void 0!==e.description){var a;r.append("description",null!==(a=e.description)&&void 0!==a?a:"")}return e.clearStartDate?r.append("startDate",""):e.startDate&&r.append("startDate",e.startDate),e.clearEndDate?r.append("endDate",""):e.endDate&&r.append("endDate",e.endDate),e.image&&r.append("image",e.image),e.status&&r.append("status",e.status),void 0!==t&&r.append("parentId",String(t)),r},L=e=>{var t,r,a,s,l,n;return{id:"number"==typeof e.id?e.id:Number(e.id),title:null!==(t=e.title)&&void 0!==t?t:"Untitled",description:"string"==typeof e.description&&e.description.trim().length>0?e.description:null,status:null!==(r=e.status)&&void 0!==r?r:"TODO",parentId:"number"==typeof e.parentId?e.parentId:null!==(a=e.parentId)&&void 0!==a?a:null,imageUrl:null!==(s=e.imageUrl)&&void 0!==s?s:void 0,startDate:null!==(l=e.startDate)&&void 0!==l?l:void 0,endDate:null!==(n=e.endDate)&&void 0!==n?n:void 0,createdAt:"string"==typeof e.createdAt?e.createdAt:new Date().toISOString(),updatedAt:"string"==typeof e.updatedAt?e.updatedAt:new Date().toISOString(),subtodos:Array.isArray(e.subtodos)?e.subtodos.map(e=>L(e)):[],timeline:Array.isArray(e.timeline)?e.timeline.map(e=>{var t;return{id:e.id,type:e.type,message:e.message,actorUserId:"number"==typeof e.actorUserId?e.actorUserId:null!==(t=e.actorUserId)&&void 0!==t?t:null,createdAt:"string"==typeof e.createdAt?e.createdAt:new Date(e.createdAt).toISOString()}}):[]}},F=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()};function R(){let e=(0,n.useRouter)(),{isAuthenticated:t,isLoading:r,user:o,logout:c}=(0,N.a)(),[u,m]=(0,s.useState)([]),x=(0,s.useRef)([]),b=(0,s.useRef)(null),h=(0,s.useRef)(!1),[f,R]=(0,s.useState)(!0),[P,J]=(0,s.useState)(null),[q,M]=(0,s.useState)(j),[z,G]=(0,s.useState)(null),[V,W]=(0,s.useState)(!1),[B,X]=(0,s.useState)(null),[Y,H]=(0,s.useState)(!1),[K,Z]=(0,s.useState)(null),[Q,$]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(null);(0,s.useEffect)(()=>{r||t||e.replace("/login")},[r,t,e]);let er=(0,s.useCallback)(e=>{window.localStorage.setItem(D,JSON.stringify(e))},[]),ea=(0,s.useCallback)(e=>{m(t=>{let r=e(t);return er(r),r})},[er]),es=(0,s.useCallback)(async()=>{if(t){R(!0);try{let e=(await (0,i.zB)()).map(e=>L(e));m(e),er(e),J(null)}catch(r){if((null==r?void 0:r.status)===401){c(),await e.replace("/login");return}let t=window.localStorage.getItem(D);if(t)try{let e=JSON.parse(t);m(e),J("Offline mode: showing cached todos.")}catch(e){J(r instanceof Error?r.message:"Failed to load todos")}else J(r instanceof Error?r.message:"Failed to load todos")}finally{R(!1)}}},[t,er,c,e]),el=(0,s.useCallback)(async()=>{if(!t||!navigator.onLine)return;let e=v();if(!e.length)return;let r=!1,a=[];for(let t=0;t<e.length;t++){let l=e[t];try{if("createTodo"===l.type){var s;let e=U(l.payload.values,null!==(s=l.payload.parentId)&&void 0!==s?s:void 0);await (0,i.JV)(e)}else"updateStatus"===l.type&&await (0,i.Os)(l.payload.id,l.payload.status);r=!0}catch(r){a.push(l,...e.slice(t+1));break}}w(a),r&&await es()},[t,es]);(0,s.useEffect)(()=>{es()},[es]),(0,s.useEffect)(()=>{el();let e=()=>{el()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[el]),(0,s.useEffect)(()=>{let e=e=>{e.preventDefault(),Z(e),$(!0),et(null)},t=()=>{Z(null),$(!1),et("App installed! You can launch it from your home screen.")};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]);let en=(0,s.useCallback)(async()=>{if(K)try{et(null),await K.prompt();let e=await K.userChoice;Z(null),$(!1),"accepted"===e.outcome?et("Install started. Check your device to finish adding the app."):et("Install dismissed. You can try again later.")}catch(e){et("Install prompt failed. Please try again later."),Z(null),$(!1)}},[K]),ei=(0,l.Dy)((0,l.VT)(l.we,{activationConstraint:{distance:8}}));(0,s.useEffect)(()=>{x.current=E(u)},[u]),(0,s.useMemo)(()=>({...l.RJ,duration:250,easing:"cubic-bezier(0.22, 1, 0.36, 1)"}),[]);let ed=(0,s.useRef)([]),eo=(0,s.useCallback)(()=>{let e=ed.current.map(e=>{let{todoId:t,status:r}=e;return{todoId:t,status:r}});window.localStorage.setItem(A,JSON.stringify(e))},[]);(0,s.useEffect)(()=>{if(t&&!f&&!h.current){h.current=!0;try{let e=window.localStorage.getItem(A);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return;let r=E(x.current),a=[];t.forEach(e=>{let{todoId:t,status:s}=e;a.push({todoId:t,status:s,snapshot:E(r)}),r=T(r,t,s)}),ed.current=a,ea(()=>r)}catch(e){window.localStorage.removeItem(A)}}},[t,f,ea]),(0,s.useEffect)(()=>{if(!t)return;let e=(0,i.bW)();if(!e)return;let r=!1,a=null,s=()=>{if(r)return;b.current&&(b.current.close(),b.current=null);let t=new URL("/api/todos/stream",i.T5);t.searchParams.set("token",e);let l=new EventSource(t.toString());b.current=l,l.onmessage=e=>{if(e.data)try{let t=JSON.parse(e.data);if(!t||t.userId!==(null==o?void 0:o.id))return;switch(t.type){case"create":case"update":case"status_single":case"status_batch":if(Array.isArray(t.todos)){let e=t.todos.map(e=>L(e));ea(t=>{let r=E(t);for(let t of e)r=C(r,t);return r})}break;case"delete":Array.isArray(t.removedIds)&&ea(e=>{var r;let a=E(e);for(let e of null!==(r=t.removedIds)&&void 0!==r?r:[])a=k(a,e);return a})}}catch(e){}},l.onerror=()=>{l.close(),r||(a=setTimeout(s,3e3))}};return s(),()=>{r=!0,a&&clearTimeout(a),b.current&&(b.current.close(),b.current=null)}},[t,ea,null==o?void 0:o.id]);let ec=async e=>{var t,r,a,s;if(e.preventDefault(),!q.title.trim()){G("Title is required");return}W(!0),G(null);let l={title:q.title.trim(),description:q.description.trim()?q.description.trim():null,startDate:q.startDate||null,endDate:q.endDate||null,image:q.image,clearStartDate:""===q.startDate,clearEndDate:""===q.endDate},n=-1*Date.now(),d=new Date().toISOString(),o={id:n,title:l.title,description:null!==(t=l.description)&&void 0!==t?t:null,startDate:null!==(r=l.startDate)&&void 0!==r?r:void 0,endDate:null!==(a=l.endDate)&&void 0!==a?a:void 0,status:null!==(s=l.status)&&void 0!==s?s:"TODO",parentId:null,imageUrl:void 0,createdAt:d,updatedAt:d,subtodos:[],timeline:[]};ea(e=>[o,...e]);let c=U(l);try{let e=await (0,i.JV)(c),t=L(e);ea(e=>{let r=k(e,n);return[t,...r]}),M(j),G(null),H(!1),es()}catch(e){if(_(e)){if(q.image){ea(e=>k(e,n)),G("Image uploads require an internet connection."),W(!1);return}y({type:"createTodo",payload:{values:{title:l.title,description:l.description,startDate:l.startDate,endDate:l.endDate,status:"TODO"},parentId:null}}),M(j),G(null),H(!1),J("Offline mode: todo will sync when you're back online.")}else ea(e=>k(e,n)),G(e instanceof Error?e.message:"Failed to create todo")}finally{W(!1)}},eu=(0,s.useCallback)(async(e,t)=>{var r,a;let s={title:t.title.trim(),description:(null===(r=t.description)||void 0===r?void 0:r.trim())?t.description.trim():null,status:"TODO"},l=-1*Date.now(),n=new Date().toISOString(),d={id:l,title:s.title,description:null!==(a=s.description)&&void 0!==a?a:null,startDate:void 0,endDate:void 0,status:"TODO",parentId:e.id,imageUrl:void 0,createdAt:n,updatedAt:n,subtodos:[],timeline:[]};ea(t=>O(t,e.id,d));try{let t=U(s,e.id),r=await (0,i.JV)(t),a=L(r);ea(e=>{let t=k(e,l);return a.parentId?O(t,a.parentId,a):[a,...t]}),es()}catch(t){_(t)?(y({type:"createTodo",payload:{values:s,parentId:e.id}}),J("Offline mode: subtodo will sync when you're back online.")):(ea(e=>k(e,l)),J(t instanceof Error?t.message:"Failed to create subtodo"))}},[es,ea]),em=(0,s.useCallback)((e,t)=>{ea(r=>T(r,e,t))},[ea]),ex=(0,s.useCallback)((e,t,r)=>{let a=ed.current.find(t=>t.todoId===e),s=a?a.snapshot:r;ed.current=ed.current.filter(t=>t.todoId!==e),ed.current.push({todoId:e,status:t,snapshot:s}),eo()},[eo]),ep=(0,s.useCallback)(async function(){let{keepalive:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===ed.current.length)return!0;let r=ed.current.map(e=>{let{todoId:t,status:r}=e;return{id:t,status:r}});try{await (0,i.dn)(r,{keepalive:t});let e=r.map(e=>e.id);return ed.current=[],eo(),ea(t=>e.reduce((e,t)=>T(e,t,"TODO"),t)),t||J(null),!0}catch(r){return t||((null==r?void 0:r.status)===401?(ed.current=[],eo(),await c(),await e.replace("/login")):J(r instanceof Error?r.message:"Failed to sync pending status updates")),!1}},[c,eo,e,ea]),eg=(0,s.useCallback)(async(e,t)=>{if(e.status===t)return;if(e.id<0){J("Please wait for this todo to sync before updating its status.");return}J(null);let r=E(x.current);em(e.id,t),ex(e.id,t,r),"undefined"==typeof navigator||navigator.onLine||(y({type:"updateStatus",payload:{id:e.id,status:t}}),J("Offline mode: status change queued for sync."))},[em,ex]),eb=(0,s.useCallback)(async e=>{let t=E(x.current);ed.current=ed.current.filter(t=>t.todoId!==e.id),eo(),ea(t=>k(t,e.id));try{await (0,i.aS)(e.id),J(null),X(t=>t===e.id?null:t)}catch(r){ea(()=>t);let e=r instanceof Error?r.message:"Failed to delete todo";throw J(e),r instanceof Error?r:Error(e)}},[i.aS,eo,ea]),eh=(0,s.useCallback)(async e=>{let t=E(x.current);ed.current=ed.current.filter(t=>t.todoId!==e.id),eo(),ea(t=>k(t,e.id));try{await (0,i.aS)(e.id),J(null)}catch(r){ea(()=>t);let e=r instanceof Error?r.message:"Failed to delete subtodo";throw J(e),r instanceof Error?r:Error(e)}},[i.aS,eo,ea]),ef=(0,s.useCallback)(async(e,t)=>{let r=E(x.current);ea(r=>I(r,e.id,{title:t.title,description:t.description}));try{let r=await (0,i.CU)(e.id,{title:t.title,description:t.description}),a=L(r);ea(e=>C(e,a)),J(null)}catch(t){let e=t instanceof Error?t.message:"Failed to update todo";throw J(e),ea(()=>r),t instanceof Error?t:Error(e)}},[J,i.CU,ea]),ey=(0,s.useCallback)(async(e,t)=>{let r=E(x.current),a={startDate:F(t.startDate),endDate:F(t.endDate)};ea(r=>I(r,e.id,{startDate:F(t.startDate),endDate:F(t.endDate)}));try{let t=await (0,i.CU)(e.id,a),r=L(t);ea(e=>C(e,r)),J(null)}catch(t){let e=t instanceof Error?t.message:"Failed to update timeline";throw J(e),ea(()=>r),t instanceof Error?t:Error(e)}},[i.CU,ea]);(0,s.useEffect)(()=>{let e=()=>{0!==ed.current.length&&ep({keepalive:!0})},t=()=>{"hidden"===document.visibilityState&&e()};return window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("pagehide",e),document.removeEventListener("visibilitychange",t)}},[ep]),(0,s.useEffect)(()=>{let e=()=>{ep()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[ep]),(0,s.useEffect)(()=>{let e=()=>{ep()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[ep]);let ev=(0,s.useCallback)(async(e,t)=>{await eg(e,t?"DONE":"TODO")},[eg]);(0,s.useEffect)(()=>()=>{b.current&&(b.current.close(),b.current=null)},[]);let ew=(0,s.useCallback)(async e=>{var t;let{active:r,over:a}=e;if(!a)return;let s=null===(t=r.data.current)||void 0===t?void 0:t.todo,l=a.id;if(s&&l&&s.status!==l)try{await eg(s,l)}catch(e){}},[eg]),eN=(0,s.useMemo)(()=>{let e={TODO:[],IN_PROGRESS:[],DONE:[]};for(let a of u){var t,r;let s=null!==(t=a.status)&&void 0!==t?t:"TODO";(null!==(r=e[s])&&void 0!==r?r:e.TODO).push({...a,status:s})}return e},[u]),ej=(0,s.useMemo)(()=>{var e;return null!=B&&null!==(e=u.find(e=>e.id===B))&&void 0!==e?e:null},[u,B]),eD=(0,s.useMemo)(()=>f?"Loading your board...":0===u.length?"Start planning with your first todo":"Todo Board",[f,u.length]);return r?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 text-sm text-gray-500",children:"Loading your workspace..."}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,a.jsxs)("nav",{className:"mb-6 flex items-center justify-between rounded-2xl bg-white/80 px-6 py-4 shadow",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-brand-500",children:"Todo App"}),(0,a.jsxs)("h1",{className:"text-lg font-semibold text-gray-900",children:["Hello, ",(null==o?void 0:o.name)||(null==o?void 0:o.email)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[Q&&(0,a.jsx)("button",{type:"button",onClick:en,className:"rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold text-white shadow transition hover:bg-brand-500/90",children:"Install app"}),(0,a.jsx)("button",{type:"button",onClick:()=>c(),className:"rounded-full border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 transition hover:border-brand-500 hover:text-brand-500",children:"Log out"})]})]}),(0,a.jsxs)("header",{className:"mb-8 text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 md:text-4xl",children:eD}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Organise todos, collaborate with subtasks, and track progress with timelines."}),ee&&(0,a.jsx)("p",{className:"mt-3 text-sm text-brand-500",children:ee})]}),P&&(0,a.jsx)("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:P}),(0,a.jsx)(l.LB,{sensors:ei,collisionDetection:l.ey,onDragEnd:ew,children:(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:S.map(e=>(0,a.jsxs)(d,{id:e.id,title:e.title,subtitle:"".concat(eN[e.id].length," tasks"),accentClass:e.accentClass,children:["TODO"===e.id&&(0,a.jsx)("button",{type:"button",onClick:()=>H(!0),className:"flex w-full items-center justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 py-10 text-sm font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"+ Add new todo"}),eN[e.id].map(e=>(0,a.jsx)(p,{todo:e,onUpdateStatus:eg,onViewDetails:e=>X(e.id),onToggleSubTodo:ev,onDeleteTodo:eb,onDeleteSubTodo:eh},e.id))]},e.id))})})]}),ej&&(0,a.jsx)(g,{todo:ej,onClose:()=>X(null),onUpdateStatus:eg,onCreateSubTodo:eu,onToggleSubTodo:ev,onDeleteTodo:eb,onDeleteSubTodo:eh,onUpdateDetails:ef,onUpdateTimeline:ey}),Y&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-xl overflow-hidden rounded-2xl bg-white shadow-xl",children:[(0,a.jsx)("header",{className:"border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-gray-400",children:"New Todo"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Create a todo"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{H(!1),M(j),G(null)},className:"rounded-full border border-gray-200 px-3 py-1 text-xs text-gray-500 transition hover:bg-gray-100",children:"Close"})]})}),(0,a.jsxs)("form",{onSubmit:ec,className:"space-y-4 px-6 py-5",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-title",children:"Title"}),(0,a.jsx)("input",{id:"modal-title",type:"text",value:q.title,onChange:e=>M(t=>({...t,title:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",placeholder:"Kick-off meeting"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-description",children:"Description"}),(0,a.jsx)("textarea",{id:"modal-description",value:q.description,onChange:e=>M(t=>({...t,description:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",rows:3,placeholder:"Context, goals, links..."})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-start",children:"Start date"}),(0,a.jsx)("input",{id:"modal-start",type:"date",value:q.startDate,onChange:e=>M(t=>({...t,startDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-end",children:"End date"}),(0,a.jsx)("input",{id:"modal-end",type:"date",value:q.endDate,onChange:e=>M(t=>({...t,endDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-image",children:"Reference image (optional)"}),(0,a.jsx)("input",{id:"modal-image",type:"file",accept:"image/*",onChange:e=>M(t=>{var r,a;return{...t,image:null!==(a=null===(r=e.target.files)||void 0===r?void 0:r[0])&&void 0!==a?a:null}}),className:"text-sm"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Attach mockups, briefs, or supporting screenshots if you have them."})]}),z&&(0,a.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:z}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>(H(!1),M(j),G(null)),className:"rounded-full border border-gray-200 px-4 py-2 text-sm text-gray-600 transition hover:bg-gray-100",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:V,className:"inline-flex items-center rounded-full bg-brand-500 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-brand-500/20 transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:V?"Creating...":"Create todo"})]})]})]})})]}):null}}},function(e){e.O(0,[675,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);