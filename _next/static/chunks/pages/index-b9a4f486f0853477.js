(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(5785)}])},5785:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var n=a(5893),s=a(7294),r=a(887);let l="https://backend-todo-9uo7.onrender.com",i={Accept:"application/json"};async function d(e){var t;let a=null;try{a=await e.json()}catch(e){}if(!e.ok)throw Error((null==a?void 0:a.message)||e.statusText||"Request failed");if((null==a?void 0:a.success)===!1)throw Error((null==a?void 0:a.message)||"Request failed");return null!==(t=null==a?void 0:a.data)&&void 0!==t?t:a}async function o(){return d(await fetch("".concat(l,"/api/todos"),{method:"GET",headers:i}))}async function c(e){return d(await fetch("".concat(l,"/api/todos"),{method:"POST",body:e}))}async function u(e,t){return d(await fetch("".concat(l,"/api/todos/").concat(e,"/status"),{method:"PATCH",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify({status:t})}))}function m(e){let{id:t,title:a,subtitle:s,accentClass:l,children:i}=e,{setNodeRef:d,isOver:o}=(0,r.Zj)({id:t});return(0,n.jsxs)("div",{ref:d,className:"flex min-h-[420px] flex-col rounded-2xl border border-gray-200 bg-gray-50/70 p-4 transition ".concat(o?"ring-2 ring-brand-500 ring-offset-2":"ring-0"),children:[(0,n.jsxs)("header",{className:"mb-4 flex items-baseline justify-between gap-2",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide ".concat(l),children:a}),s&&(0,n.jsx)("span",{className:"text-xs text-gray-500",children:s})]}),(0,n.jsx)("div",{className:"flex-1 space-y-3",children:i})]})}var g=a(4285);let p=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t},x=e=>{if(!e)return"-";let t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString()},b={TODO:"bg-gray-100 text-gray-700 border border-gray-200",IN_PROGRESS:"bg-yellow-100 text-yellow-700 border border-yellow-200",DONE:"bg-green-100 text-green-700 border border-green-200"},y={TODO:"text-lg font-semibold text-gray-800",IN_PROGRESS:"text-lg font-semibold text-yellow-600",DONE:"text-lg font-semibold text-green-600 line-through"},h={TODO:"text-sm font-medium text-gray-700",IN_PROGRESS:"text-sm font-medium text-yellow-600",DONE:"text-sm font-medium text-green-600 line-through"},f={TODO:"Chưa l\xe0m",IN_PROGRESS:"Đang l\xe0m",DONE:"Đ\xe3 l\xe0m"};function v(e){let{todo:t,onUpdateStatus:a,onViewDetails:r,onToggleSubTodo:i}=e,[d,o]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null);!function(e){var t,a,n;if(null===(t=e.subtodos)||void 0===t?void 0:t.length){let t=e.subtodos.map(e=>p(e.startDate)).filter(e=>!!e).sort((e,t)=>e.getTime()-t.getTime()),a=e.subtodos.map(e=>p(e.endDate)).filter(e=>!!e).sort((e,t)=>t.getTime()-e.getTime());return t[0],null!==(n=a[0])&&void 0!==n?n:null}p(e.startDate),p(e.endDate)}(t);let m=t.imageUrl?t.imageUrl.startsWith("http")?t.imageUrl:"".concat(l).concat(t.imageUrl):null,g=async e=>{if(e!==t.status){o(!0),u(null);try{await a(t,e)}catch(e){u(e instanceof Error?e.message:"Kh\xf4ng thể cập nhật trạng th\xe1i.")}finally{o(!1)}}},x=async(e,t)=>{if(i){u(null);try{await i(e,t)}catch(e){u(e instanceof Error?e.message:"Kh\xf4ng thể cập nhật subtodo.")}}};return(0,n.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm ring-1 ring-transparent transition hover:shadow-md",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("span",{className:y[t.status],children:t.title}),t.pendingSync&&(0,n.jsx)("p",{className:"text-xs font-medium uppercase tracking-wide text-orange-500",children:"Pending sync"})]}),(0,n.jsx)("div",{className:"flex flex-col items-end gap-2",children:(0,n.jsx)("span",{className:"inline-flex w-fit items-center gap-2 rounded-full px-3 py-1 text-xs font-medium ".concat(b[t.status]),children:f[t.status]})})]}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("label",{className:"sr-only",htmlFor:"status-select-".concat(t.id),children:"Update status"}),(0,n.jsxs)("select",{id:"status-select-".concat(t.id),value:t.status,onChange:e=>g(e.target.value),disabled:d||t.pendingSync,className:"w-full rounded-md border border-r-8 border-transparent outline outline-gray-200 bg-white px-2 py-2 text-xs font-medium text-gray-700 shadow-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:bg-gray-100 disabled:text-gray-400",children:[(0,n.jsx)("option",{value:"TODO",children:"Chưa l\xe0m"}),(0,n.jsx)("option",{value:"IN_PROGRESS",children:"Đang l\xe0m"}),(0,n.jsx)("option",{value:"DONE",children:"Đ\xe3 l\xe0m"})]})]}),t.description&&(0,n.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:t.description}),m&&(0,n.jsx)("img",{src:m,alt:t.title,className:"mt-3 h-40 w-full rounded-lg object-cover"}),t.subtodos&&t.subtodos.length>0&&(0,n.jsxs)("details",{className:"mt-3 rounded-lg border border-gray-100 bg-gray-50 p-3",children:[(0,n.jsxs)("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700",children:["Todos (",t.subtodos.length,")"]}),(0,n.jsx)("ul",{className:"mt-2 space-y-2",children:t.subtodos.map(e=>(0,n.jsxs)("li",{className:"flex items-start gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:"DONE"===e.status,onChange:t=>x(e,t.target.checked),disabled:!!(t.pendingSync||e.pendingSync),className:"mt-1 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500 ".concat(t.pendingSync||e.pendingSync?"cursor-not-allowed opacity-60":"")}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:h[e.status],children:e.title}),e.description&&(0,n.jsx)("p",{className:"text-xs text-gray-500",children:e.description}),e.pendingSync&&(0,n.jsx)("p",{className:"text-[10px] font-medium uppercase tracking-wide text-orange-500",children:"Pending sync"})]})]},e.id))})]}),r&&(0,n.jsx)("button",{type:"button",onClick:()=>r(t),className:"mt-4 inline-flex items-center justify-center rounded-md border border-brand-500 px-3 py-1 text-xs font-semibold text-brand-500 transition hover:bg-brand-500/10",children:"View details"}),c&&(0,n.jsx)("p",{className:"mt-3 text-xs text-red-600",children:c})]})}function w(e){let{todo:t,onUpdateStatus:a,onViewDetails:s,onToggleSubTodo:l}=e,{attributes:i,listeners:d,setNodeRef:o,transform:c,isDragging:u}=(0,r.O1)({id:"todo-".concat(t.id),data:{todo:t},disabled:!!t.pendingSync}),m={transform:c?g.ux.Translate.toString(c):void 0,opacity:u?.5:1,transition:u?void 0:"transform 180ms ease, box-shadow 180ms ease"};return(0,n.jsx)("div",{ref:o,style:m,...d,...i,className:t.pendingSync?"cursor-not-allowed":"cursor-grab active:cursor-grabbing",children:(0,n.jsx)(v,{todo:t,onUpdateStatus:a,onViewDetails:s,onToggleSubTodo:l})})}let N={TODO:"Chưa l\xe0m",IN_PROGRESS:"Đang l\xe0m",DONE:"Đ\xe3 l\xe0m"};function j(e){var t,a,r,i;let{todo:d,onClose:o,onUpdateStatus:c,onCreateSubTodo:u,onToggleSubTodo:m}=e,g=(0,s.useMemo)(()=>new Date(d.createdAt).toLocaleString(),[d.createdAt]),p=d.imageUrl?d.imageUrl.startsWith("http")?d.imageUrl:"".concat(l).concat(d.imageUrl):null,[b,y]=(0,s.useState)(""),[h,f]=(0,s.useState)(""),[v,w]=(0,s.useState)(!1),[j,D]=(0,s.useState)(null),S=async e=>{e!==d.status&&await c(d,e)},O=async(e,t)=>{await m(e,t)},C=async e=>{if(e.preventDefault(),!b.trim()){D("Subtodo title is required");return}w(!0),D(null);try{await u(d,{title:b.trim(),description:h.trim()||void 0}),y(""),f("")}catch(e){D(e instanceof Error?e.message:"Failed to create subtodo")}finally{w(!1)}};return(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,n.jsxs)("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl bg-white shadow-xl",children:[(0,n.jsxs)("header",{className:"flex items-start justify-between gap-4 border-b border-gray-200 p-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Todo Detail"}),(0,n.jsx)("h2",{className:"mt-1 text-2xl font-semibold text-gray-900",children:d.title}),(0,n.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Created at: ",g]}),d.pendingSync&&(0,n.jsx)("p",{className:"mt-2 text-xs font-semibold uppercase tracking-wide text-orange-500",children:"Pending sync"})]}),(0,n.jsx)("button",{type:"button",onClick:o,className:"rounded-full border border-gray-300 px-3 py-1 text-sm text-gray-500 transition hover:bg-gray-100",children:"Close"})]}),(0,n.jsxs)("div",{className:"space-y-6 p-6",children:[(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Description"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:d.description||"No description provided"})]}),p&&(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Attached image"}),(0,n.jsx)("img",{src:p,alt:d.title,className:"mt-3 w-full rounded-lg object-cover shadow"})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Status"}),(0,n.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600",children:["Current: ",N[d.status]]}),(0,n.jsxs)("select",{value:d.status,onChange:e=>S(e.target.value),disabled:d.pendingSync,className:"rounded border border-gray-300 px-3 py-1 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-60",children:[(0,n.jsx)("option",{value:"TODO",children:"Chưa l\xe0m"}),(0,n.jsx)("option",{value:"IN_PROGRESS",children:"Đang l\xe0m"}),(0,n.jsx)("option",{value:"DONE",children:"Đ\xe3 l\xe0m"})]}),d.pendingSync&&(0,n.jsx)("span",{className:"text-xs font-medium text-orange-500",children:"Sync required before changes"})]})]}),(0,n.jsxs)("section",{className:"grid gap-1 md:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Start date"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d.startDate?x(d.startDate):"-"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"End date"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d.endDate?x(d.endDate):"-"})]})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["SubTodos (",null!==(r=null===(t=d.subtodos)||void 0===t?void 0:t.length)&&void 0!==r?r:0,")"]})}),(0,n.jsx)("div",{className:"mt-3 space-y-3",children:0===(null!==(i=d.subtodos)&&void 0!==i?i:[]).length?(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"No subtodos yet."}):null===(a=d.subtodos)||void 0===a?void 0:a.map(e=>(0,n.jsxs)("label",{className:"flex items-start gap-3 rounded-lg border border-gray-200 bg-gray-50 p-3",children:[(0,n.jsx)("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500 disabled:cursor-not-allowed disabled:opacity-60",checked:"DONE"===e.status,onChange:t=>O(e,t.target.checked),disabled:!!(d.pendingSync||e.pendingSync)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium ".concat("DONE"===e.status?"text-green-600 line-through":"text-gray-700"),children:e.title}),e.description&&(0,n.jsx)("p",{className:"text-xs text-gray-500",children:e.description}),e.pendingSync&&(0,n.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-orange-500",children:"Pending sync"})]})]},e.id))}),(0,n.jsxs)("form",{className:"mt-4 space-y-3 rounded-lg border border-dashed border-gray-300 bg-gray-50 p-3",onSubmit:C,children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Add Subtodo"})}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"Subtodo title",disabled:d.pendingSync,className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-60"}),(0,n.jsx)("textarea",{value:h,onChange:e=>f(e.target.value),placeholder:"Optional description",disabled:d.pendingSync,className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-60",rows:2})]}),j&&(0,n.jsx)("p",{className:"text-xs text-red-600",children:j}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{type:"submit",disabled:v||d.pendingSync,className:"inline-flex items-center justify-center rounded-md bg-brand-500 px-3 py-1 text-sm font-semibold text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:v?"Adding...":"Add Subtodo"})})]})]})]})]})})}let D="todo_offline_queue_v1",S=()=>{try{let e=window.localStorage.getItem(D);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("Failed to read offline queue",e),[]}},O=e=>{if(!e.length){window.localStorage.removeItem(D);return}window.localStorage.setItem(D,JSON.stringify(e))},C=e=>{let t=S();t.push(e),O(t)},E=()=>{let e=S();return O([]),e},T=e=>{O(e)},k={title:"",description:"",startDate:"",endDate:"",image:null},I=(e,t)=>{let a=new FormData;if(void 0!==e.title&&a.append("title",e.title),void 0!==e.description){var n;a.append("description",null!==(n=e.description)&&void 0!==n?n:"")}return e.clearStartDate?a.append("startDate",""):e.startDate&&a.append("startDate",e.startDate),e.clearEndDate?a.append("endDate",""):e.endDate&&a.append("endDate",e.endDate),e.image&&a.append("image",e.image),e.status&&a.append("status",e.status),void 0!==t&&a.append("parentId",String(t)),a},A=[{id:"TODO",title:"Todo",accentClass:"text-gray-500"},{id:"IN_PROGRESS",title:"In Progress",accentClass:"text-yellow-600"},{id:"DONE",title:"Done",accentClass:"text-green-600"}],R="todo_cached_todos_v1",_=e=>{var t;let a={id:e.id,title:e.title,description:"string"==typeof e.description?e.description:null,imageUrl:"string"==typeof e.imageUrl||null===e.imageUrl?e.imageUrl:null,startDate:"string"==typeof e.startDate?e.startDate:null,endDate:"string"==typeof e.endDate?e.endDate:null,status:null!==(t=e.status)&&void 0!==t?t:"TODO",parentId:"number"==typeof e.parentId?e.parentId:null,createdAt:"string"==typeof e.createdAt?e.createdAt:new Date().toISOString(),updatedAt:"string"==typeof e.updatedAt?e.updatedAt:new Date().toISOString(),subtodos:void 0,pendingSync:!1};return Array.isArray(e.subtodos)&&(a.subtodos=e.subtodos.map(e=>_(e))),a};function P(){let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[i,d]=(0,s.useState)(null),[g,p]=(0,s.useState)(k),[x,b]=(0,s.useState)(null),[y,h]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[N,D]=(0,s.useState)(!1),[S,O]=(0,s.useState)(null),[P,F]=(0,s.useState)(!1),[U,L]=(0,s.useState)(null),G=(0,s.useRef)(null),q=(0,s.useRef)(null),J=(0,s.useRef)(null),M=(0,s.useRef)(null),V=(0,s.useRef)(null),K=(0,s.useRef)(0),Y=(0,s.useCallback)(e=>{window.localStorage.setItem(R,JSON.stringify(e))},[]),z=(0,s.useCallback)(e=>{t(t=>{let a=e(t);return Y(a),a})},[Y]),W=(0,s.useCallback)((e,t,a)=>{z(n=>n.map(n=>{var s,r;if(n.id===e){let e="DONE"===t?null===(r=n.subtodos)||void 0===r?void 0:r.map(e=>({...e,status:"DONE",pendingSync:!!a||e.pendingSync})):n.subtodos;return{...n,status:t,pendingSync:!!a||n.pendingSync,subtodos:e}}return(null===(s=n.subtodos)||void 0===s?void 0:s.some(t=>t.id===e))?{...n,subtodos:n.subtodos.map(n=>n.id===e?{...n,status:t,pendingSync:!!a||n.pendingSync}:n)}:n}))},[z]),X=(0,r.Dy)((0,r.VT)(r.we,{activationConstraint:{distance:8}})),B=(0,s.useCallback)(()=>{"undefined"!=typeof document&&null===G.current&&(K.current=window.scrollY||0,G.current=document.body.style.overflow,q.current=document.body.style.touchAction,J.current=document.body.style.position,M.current=document.body.style.top,V.current=document.body.style.width,document.body.style.overflow="hidden",document.body.style.touchAction="none",document.body.style.position="fixed",document.body.style.top="-".concat(K.current,"px"),document.body.style.width="100%")},[]),H=(0,s.useCallback)(()=>{"undefined"!=typeof document&&null!==G.current&&(document.body.style.overflow=G.current||"",document.body.style.touchAction=q.current||"",document.body.style.position=J.current||"",document.body.style.top=M.current||"",document.body.style.width=V.current||"",window.scrollTo(0,K.current||0),G.current=null,q.current=null,J.current=null,M.current=null,V.current=null)},[]);(0,s.useEffect)(()=>{let e=e=>{e.preventDefault(),O(e),F(!0),L(null)},t=()=>{O(null),F(!1),L("App installed! You can launch it from your home screen.")};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t),H()}},[H]);let Q=(0,s.useCallback)(async()=>{l(!0);try{let e=(await o()).map(e=>_(e));t(e),Y(e),d(null)}catch(a){let e=window.localStorage.getItem(R);if(e)try{let a=JSON.parse(e);t(a),d("Offline mode: showing the last synced board.")}catch(e){d(a instanceof Error?a.message:"Failed to load todos")}else d(a instanceof Error?a.message:"Failed to load todos")}finally{l(!1)}},[Y]),Z=(0,s.useCallback)(async(e,t)=>{var a,n;if(e.pendingSync){d("Please wait for the parent todo to sync before adding subtodos.");return}let s={title:t.title.trim(),description:(null===(a=t.description)||void 0===a?void 0:a.trim())?t.description.trim():null,status:"TODO"};try{let t=I(s,e.id);await c(t),await Q()}catch(t){if("undefined"!=typeof navigator&&(!navigator.onLine||t instanceof TypeError&&"Failed to fetch"===t.message)){C({type:"createTodo",payload:{values:s,parentId:e.id}});let t=-1*Date.now(),a=new Date().toISOString(),r={id:t,title:s.title,description:null!==(n=s.description)&&void 0!==n?n:null,status:"TODO",parentId:e.id,imageUrl:void 0,startDate:void 0,endDate:void 0,createdAt:a,updatedAt:a,subtodos:void 0,pendingSync:!0};z(t=>t.map(t=>{var a;return t.id===e.id?{...t,subtodos:[...null!==(a=t.subtodos)&&void 0!==a?a:[],r]}:t})),d("Offline mode: subtodo will sync when you're back online.")}else d(t instanceof Error?t.message:"Failed to create subtodo")}},[Q,z]);(0,s.useEffect)(()=>{Q()},[Q]);let $=(0,s.useCallback)(async()=>{if(!navigator.onLine)return;let e=E();if(!e.length)return;let t=!1,a=[];for(let s=0;s<e.length;s++){let r=e[s];try{if("createTodo"===r.type){var n;let e=new FormData,{values:t,parentId:a}=r.payload;e.append("title",t.title),t.description&&e.append("description",t.description),t.startDate&&e.append("startDate",t.startDate),t.endDate&&e.append("endDate",t.endDate),e.append("status",null!==(n=t.status)&&void 0!==n?n:"TODO"),"number"==typeof a&&e.append("parentId",String(a)),await c(e)}else"updateStatus"===r.type&&await u(r.payload.id,r.payload.status);t=!0}catch(t){a.push(r,...e.slice(s+1));break}}T(a),t&&await Q()},[Q]);(0,s.useEffect)(()=>{$();let e=()=>{$()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[$]);let ee=async e=>{if(e.preventDefault(),!g.title.trim()){b("Title is required");return}h(!0),b(null);try{let e={title:g.title.trim(),description:g.description.trim()?g.description.trim():null,startDate:g.startDate||null,endDate:g.endDate||null,image:g.image,clearStartDate:""===g.startDate,clearEndDate:""===g.endDate},t=I(e);await c(t),p(k),b(null),await Q(),D(!1)}catch(e){if("undefined"!=typeof navigator&&(!navigator.onLine||e instanceof TypeError&&"Failed to fetch"===e.message)){var t,a,n;if(g.image){b("Image uploads require an internet connection."),h(!1);return}let e={title:g.title.trim(),description:g.description.trim()?g.description.trim():null,startDate:g.startDate||null,endDate:g.endDate||null,status:"TODO"};C({type:"createTodo",payload:{values:e,parentId:null}});let s=-1*Date.now(),r=new Date().toISOString(),l={id:s,title:e.title,description:null!==(t=e.description)&&void 0!==t?t:null,startDate:null!==(a=e.startDate)&&void 0!==a?a:void 0,endDate:null!==(n=e.endDate)&&void 0!==n?n:void 0,status:"TODO",parentId:null,imageUrl:void 0,createdAt:r,updatedAt:r,subtodos:[],pendingSync:!0};z(e=>[l,...e]),p(k),b(null),D(!1),d("Offline mode: todo will sync when you're back online.")}else b(e instanceof Error?e.message:"Failed to create todo")}finally{h(!1)}},et=(0,s.useCallback)(async(e,t)=>{if(e.status!==t){if(e.pendingSync||e.id<0){d("Please wait for this todo to sync before updating its status.");return}if(d(null),"undefined"!=typeof navigator&&!navigator.onLine){W(e.id,t,!0),C({type:"updateStatus",payload:{id:e.id,status:t}}),d("Offline mode: status change queued for sync.");return}try{await u(e.id,t),await Q()}catch(t){let e=t instanceof Error?t.message:"Failed to update todo status";throw d(e),t instanceof Error?t:Error(e)}}},[W,Q]),ea=(0,s.useCallback)(async(e,t)=>{await et(e,t?"DONE":"TODO")},[et]),en=(0,s.useCallback)(async e=>{var t;H();let{active:a,over:n}=e;if(!n)return;let s=null===(t=a.data.current)||void 0===t?void 0:t.todo,r=n.id;if(s&&r&&s.status!==r)try{await et(s,r)}catch(e){}},[et,H]),es=(0,s.useCallback)(()=>{B()},[B]),er=(0,s.useCallback)(()=>{H()},[H]),el=(0,s.useMemo)(()=>{let t={TODO:[],IN_PROGRESS:[],DONE:[]};for(let s of e){var a,n;let e=null!==(a=s.status)&&void 0!==a?a:"TODO";(null!==(n=t[e])&&void 0!==n?n:t.TODO).push({...s,status:e})}return t},[e]),ei=(0,s.useMemo)(()=>{var t;return null!=f&&null!==(t=e.find(e=>e.id===f))&&void 0!==t?t:null},[e,f]),ed=(0,s.useMemo)(()=>a?"Loading your board...":0===e.length?"Start planning with your first todo":"Todo List",[a,e.length]),eo=(0,s.useCallback)(e=>{v(e.id)},[]),ec=(0,s.useCallback)(()=>{v(null)},[]),eu=(0,s.useCallback)(async()=>{if(S)try{L(null),await S.prompt();let e=await S.userChoice;O(null),F(!1),"accepted"===e.outcome?L("Install started. Check your device to finish adding the app."):L("Install dismissed. You can try again later.")}catch(e){L("Install prompt failed. Please try again later."),O(null),F(!1)}},[S]);return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,n.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,n.jsxs)("header",{className:"mb-8 text-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 md:text-4xl",children:ed}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Quản l\xfd v\xe0 note những điều cần l\xe0m"}),P&&(0,n.jsx)("div",{className:"mt-4 flex justify-center",children:(0,n.jsxs)("button",{type:"button",onClick:eu,className:"inline-flex items-center gap-2 rounded-full bg-brand-500 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-brand-500/90",children:[(0,n.jsx)("span",{role:"img","aria-hidden":"true",children:"\uD83D\uDCF2"}),"Install this app on your device"]})}),U&&(0,n.jsx)("p",{className:"mt-3 text-sm text-brand-500",children:U})]}),i&&(0,n.jsx)("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:i}),(0,n.jsx)(r.LB,{sensors:X,collisionDetection:r.ey,onDragStart:es,onDragEnd:en,onDragCancel:er,children:(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:A.map(e=>(0,n.jsxs)(m,{id:e.id,title:e.title,subtitle:"".concat(el[e.id].length," tasks"),accentClass:e.accentClass,children:["TODO"===e.id&&(0,n.jsx)("button",{type:"button",onClick:()=>D(!0),className:"flex w-full items-center justify-center rounded-xl border border-dashed border-gray-300 bg-white py-10 text-sm font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"+ Add new todo"}),el[e.id].map(e=>(0,n.jsx)(w,{todo:e,onUpdateStatus:et,onViewDetails:eo,onToggleSubTodo:ea},e.id))]},e.id))})})]}),ei&&(0,n.jsx)(j,{todo:ei,onClose:ec,onUpdateStatus:et,onCreateSubTodo:Z,onToggleSubTodo:ea}),N&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-xl overflow-hidden rounded-2xl bg-white shadow-xl",children:[(0,n.jsx)("header",{className:"border-b border-gray-200 px-6 py-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-gray-400",children:"New Todo"}),(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Create a todo"})]}),(0,n.jsx)("button",{type:"button",onClick:()=>D(!1),className:"rounded-full border border-gray-200 px-3 py-1 text-xs text-gray-500 transition hover:bg-gray-100",children:"Close"})]})}),(0,n.jsxs)("form",{onSubmit:ee,className:"space-y-4 px-6 py-5",children:[(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-title",children:"Title"}),(0,n.jsx)("input",{id:"modal-title",type:"text",value:g.title,onChange:e=>p(t=>({...t,title:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",placeholder:"Kick-off meeting"})]}),(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-description",children:"Description"}),(0,n.jsx)("textarea",{id:"modal-description",value:g.description,onChange:e=>p(t=>({...t,description:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",rows:3,placeholder:"Context, goals, links..."})]}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-start",children:"Start date"}),(0,n.jsx)("input",{id:"modal-start",type:"date",value:g.startDate,onChange:e=>p(t=>({...t,startDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]}),(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-end",children:"End date"}),(0,n.jsx)("input",{id:"modal-end",type:"date",value:g.endDate,onChange:e=>p(t=>({...t,endDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]})]}),(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-image",children:"Reference image (optional)"}),(0,n.jsx)("input",{id:"modal-image",type:"file",accept:"image/*",onChange:e=>p(t=>{var a,n;return{...t,image:null!==(n=null===(a=e.target.files)||void 0===a?void 0:a[0])&&void 0!==n?n:null}}),className:"text-sm"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Attach mockups, briefs, or supporting screenshots if you have them."})]}),x&&(0,n.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>(D(!1),p(k),b(null)),className:"rounded-full border border-gray-200 px-4 py-2 text-sm text-gray-600 transition hover:bg-gray-100",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",disabled:y,className:"inline-flex items-center rounded-full bg-brand-500 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-brand-500/20 transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:y?"Creating...":"Create todo"})]})]})]})})]})}}},function(e){e.O(0,[887,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);