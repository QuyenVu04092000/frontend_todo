(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(6906)}])},6906:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return F}});var a=r(5893),s=r(7294),l=r(887),n=r(1163),o=r(4279),i=e=>{let{id:t,title:r,subtitle:s,accentClass:n="text-gray-500",children:o}=e,{setNodeRef:i,isOver:d}=(0,l.Zj)({id:t});return(0,a.jsxs)("section",{ref:i,className:"flex flex-col gap-4 rounded-2xl bg-white p-4 shadow transition ".concat(d?"ring-2 ring-brand-500/70":"ring-1 ring-gray-100"),children:[(0,a.jsxs)("header",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-widest ".concat(n),children:r}),s&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:s})]}),(0,a.jsx)("div",{className:"flex flex-1 flex-col gap-3",children:o})]})},d=r(4285);let c=e=>{if(!e)return"";let t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)},u=e=>{if(!e)return"-";let t=e instanceof Date?e:new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString()},m=["TODO","IN_PROGRESS","DONE"],p=e=>{let t=m.indexOf(e);return -1===t||t===m.length-1?null:m[t+1]};var x=e=>{var t;let{todo:r,onUpdateStatus:n,onViewDetails:i,onToggleSubTodo:c,onDeleteTodo:m,onDeleteSubTodo:x}=e,{attributes:g,listeners:b,setNodeRef:h,transform:f,isDragging:y}=(0,l.O1)({id:r.id,data:{todo:r}}),v={transform:f?d.ux.Translate.toString(f):void 0,opacity:y?.6:1,transition:y?"none":"transform 220ms cubic-bezier(0.25, 0.8, 0.25, 1)"},w=null!==(t=r.subtodos)&&void 0!==t?t:[],N=(0,s.useMemo)(()=>w.filter(e=>"DONE"===e.status).length,[w]);p(r.status);let j=(0,s.useMemo)(()=>r.imageUrl?r.imageUrl.startsWith("http://")||r.imageUrl.startsWith("https://")?r.imageUrl:"".concat(o.T5).concat(r.imageUrl):null,[r.imageUrl]);return(0,a.jsxs)("article",{ref:h,style:v,...g,...b,className:"group flex cursor-grab flex-col gap-3 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm transition-all duration-200 ease-out hover:-translate-y-1 hover:shadow-xl active:cursor-grabbing",children:[(0,a.jsxs)("header",{className:"flex items-start justify-between gap-2",children:[(0,a.jsx)("div",{className:"space-y-1",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:r.title})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>i(r),className:"rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"Details"}),(0,a.jsx)("button",{type:"button",onClick:()=>{m(r).catch(()=>{})},className:"rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"})]})]}),(0,a.jsxs)("select",{value:r.status,onChange:e=>n(r,e.target.value),className:"rounded border border-transparent outline outline-gray-300 px-4 py-1 text-sm focus-visible:ring-brand-500/30",children:[(0,a.jsx)("option",{value:"TODO",children:"Chưa l\xe0m"}),(0,a.jsx)("option",{value:"IN_PROGRESS",children:"Đang l\xe0m"}),(0,a.jsx)("option",{value:"DONE",children:"Đ\xe3 l\xe0m"})]}),r.description&&(0,a.jsx)("p",{className:"line-clamp-3 text-sm text-gray-600",children:r.description}),j&&(0,a.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,a.jsx)("img",{src:j,alt:"".concat(r.title," reference"),className:"h-36 w-full object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]",loading:"lazy"})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs text-gray-500",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold uppercase tracking-wider text-gray-400",children:"Start"}),(0,a.jsx)("p",{children:r.startDate?u(r.startDate):"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold uppercase tracking-wider text-gray-400",children:"End"}),(0,a.jsx)("p",{children:r.endDate?u(r.endDate):"-"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-400",children:"Subtodos"}),0===w.length?(0,a.jsx)("p",{className:"rounded-xl border border-dashed border-gray-200 bg-gray-50 px-3 py-2 text-xs text-gray-500",children:"No subtodos yet."}):(0,a.jsx)("ul",{className:"space-y-2",children:w.map(e=>{let t="DONE"===e.status;return(0,a.jsxs)("li",{className:"flex items-start gap-2 rounded-xl border border-gray-100 bg-gray-50/70 px-3 py-2 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500",checked:t,onChange:t=>c(e,t.target.checked)}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("p",{className:"font-medium ".concat(t?"text-gray-500 line-through":"text-gray-700"),children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-[11px] text-gray-500",children:e.description})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{x(e).catch(()=>{})},className:"rounded-full border border-gray-200 px-2 py-1 text-[10px] font-semibold uppercase tracking-wide text-gray-500 transition hover:border-red-400 hover:text-red-500","aria-label":"Delete ".concat(e.title),children:"Delete"})]},e.id)})})]}),(0,a.jsxs)("footer",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,a.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-[10px] font-semibold uppercase tracking-wide ".concat("DONE"===r.status?"bg-green-100 text-green-700":"IN_PROGRESS"===r.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"),children:r.status.replace("_"," ")}),w.length>0&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-[10px] font-medium uppercase tracking-wide text-gray-600",children:[(0,a.jsx)("span",{role:"img","aria-hidden":"true",children:"\uD83E\uDDE9"}),N,"/",w.length]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:"DONE"===r.status&&w.length>0&&(0,a.jsx)("button",{type:"button",onClick:async()=>{await Promise.all(w.map(e=>c(e,!0)))},className:"rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"Mark subtodos done"})})]})]})};function g(e){var t,r,l,n,i;let{todo:d,onClose:u,onUpdateStatus:m,onCreateSubTodo:p,onToggleSubTodo:x,onDeleteTodo:g,onDeleteSubTodo:b,onUpdateDetails:h,onUpdateTimeline:f}=e,y=(0,s.useMemo)(()=>new Date(d.createdAt).toLocaleString(),[d.createdAt]),v=d.imageUrl?d.imageUrl.startsWith("http")?d.imageUrl:"".concat(o.T5).concat(d.imageUrl):null,[w,N]=(0,s.useState)(""),[j,D]=(0,s.useState)(""),[S,E]=(0,s.useState)(!1),[O,k]=(0,s.useState)(null),[C,T]=(0,s.useState)(c(d.startDate)),[I,A]=(0,s.useState)(c(d.endDate)),[_,P]=(0,s.useState)(!1),[U,L]=(0,s.useState)(null),[F,R]=(0,s.useState)(null),[J,B]=(0,s.useState)(d.title),[V,q]=(0,s.useState)(null!==(l=d.description)&&void 0!==l?l:""),[M,z]=(0,s.useState)(!1),[G,W]=(0,s.useState)(null),[X,Y]=(0,s.useState)(null);(0,s.useEffect)(()=>{var e;B(d.title),q(null!==(e=d.description)&&void 0!==e?e:""),W(null),Y(null),T(c(d.startDate)),A(c(d.endDate)),L(null),R(null)},[d.description,d.endDate,d.id,d.startDate,d.title]);let H=async(e,t)=>{await x(e,t)},K=async e=>{k(null);try{await b(e)}catch(e){k(e instanceof Error?e.message:"Failed to delete subtodo")}},Z=async()=>{try{await g(d),u()}catch(e){k(e instanceof Error?e.message:"Failed to delete todo")}},Q=async e=>{var t;e.preventDefault();let r=J.trim(),a=V.trim();if(!r){W("Title is required"),Y(null);return}let s=(null!==(t=d.description)&&void 0!==t?t:"").trim();if(r===d.title&&a===s){W(null),Y("No changes to save");return}z(!0),W(null),Y(null);try{await h(d,{title:r,description:a||null}),B(r),q(a),Y("Todo details updated")}catch(e){W(e instanceof Error?e.message:"Failed to update todo")}finally{z(!1)}},$=async e=>{e.preventDefault(),P(!0),L(null),R(null);try{await f(d,{startDate:C||null,endDate:I||null}),R("Timeline updated")}catch(e){L(e instanceof Error?e.message:"Failed to update timeline")}P(!1)},ee=async e=>{if(e.preventDefault(),!w.trim()){k("Subtodo title is required");return}E(!0),k(null);try{await p(d,{title:w.trim(),description:j.trim()||void 0}),N(""),D("")}catch(e){k(e instanceof Error?e.message:"Failed to create subtodo")}finally{E(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,a.jsxs)("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl bg-white shadow-xl",children:[(0,a.jsxs)("header",{className:"flex items-start justify-between gap-4 border-b border-gray-200 p-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Todo Detail"}),(0,a.jsx)("h2",{className:"mt-1 text-2xl font-semibold text-gray-900",children:d.title}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Created at: ",y]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:Z,className:"rounded-full border border-red-200 px-3 py-1 text-sm font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"}),(0,a.jsx)("button",{type:"button",onClick:u,className:"rounded-full border border-gray-300 px-3 py-1 text-sm text-gray-500 transition hover:bg-gray-100",children:"Close"})]})]}),(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Edit details"}),(0,a.jsxs)("form",{onSubmit:Q,className:"mt-3 space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",htmlFor:"todo-title",children:"Title"}),(0,a.jsx)("input",{id:"todo-title",type:"text",value:J,onChange:e=>{B(e.target.value),W(null),Y(null)},disabled:M,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-70",placeholder:"Project kickoff"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",htmlFor:"todo-description",children:"Description"}),(0,a.jsx)("textarea",{id:"todo-description",value:V,onChange:e=>{q(e.target.value),W(null),Y(null)},disabled:M,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30 disabled:cursor-not-allowed disabled:opacity-70",rows:4,placeholder:"Context, goals, links..."})]}),(G||X)&&(0,a.jsx)("p",{className:"text-sm ".concat(G?"text-red-600":"text-emerald-600"),children:null!=G?G:X}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:M,className:"inline-flex items-center rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:M?"Saving…":"Save changes"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;B(d.title),q(null!==(e=d.description)&&void 0!==e?e:""),W(null),Y(null)},disabled:M,className:"rounded-full border border-gray-300 px-4 py-2 text-xs font-medium text-gray-600 transition hover:border-brand-500 hover:text-brand-500 disabled:cursor-not-allowed disabled:opacity-70",children:"Reset"})]})]})]}),v&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Attached image"}),(0,a.jsx)("img",{src:v,alt:d.title,className:"mt-3 w-full rounded-lg object-cover shadow"})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Status"}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:(0,a.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-[10px] font-semibold uppercase tracking-wide ".concat("DONE"===d.status?"bg-green-100 text-green-700":"IN_PROGRESS"===d.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"),children:d.status.replace("_"," ")})})]}),(0,a.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Timeline"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Set the planned start and end dates for this todo."}),(0,a.jsxs)("form",{onSubmit:$,className:"mt-3 grid gap-3 md:grid-cols-2",children:[(0,a.jsxs)("label",{className:"grid gap-1 text-xs font-semibold uppercase tracking-wide text-gray-500",children:["Start date",(0,a.jsx)("input",{type:"date",value:C,onChange:e=>{T(e.target.value),L(null),R(null)},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",disabled:_})]}),(0,a.jsxs)("label",{className:"grid gap-1 text-xs font-semibold uppercase tracking-wide text-gray-500",children:["End date",(0,a.jsx)("input",{type:"date",value:I,onChange:e=>{A(e.target.value),L(null),R(null)},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",disabled:_})]}),(0,a.jsxs)("div",{className:"col-span-full flex flex-col gap-2 text-sm",children:[U&&(0,a.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-red-600",children:U}),F&&(0,a.jsx)("p",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-emerald-600",children:F}),(0,a.jsx)("button",{type:"submit",disabled:_,className:"self-start rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:_?"Saving…":"Save timeline"})]})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["SubTodos (",null!==(n=null===(t=d.subtodos)||void 0===t?void 0:t.length)&&void 0!==n?n:0,")"]})}),(0,a.jsx)("div",{className:"mt-3 space-y-3",children:0===(null!==(i=d.subtodos)&&void 0!==i?i:[]).length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No subtodos yet."}):null===(r=d.subtodos)||void 0===r?void 0:r.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-gray-200 bg-gray-50 p-3",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-brand-500 focus:ring-brand-500",checked:"DONE"===e.status,onChange:t=>H(e,t.target.checked)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat("DONE"===e.status?"text-green-600 line-through":"text-gray-700"),children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{K(e)},className:"rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-500 transition hover:bg-red-50",children:"Delete"})]},e.id))}),(0,a.jsxs)("form",{className:"mt-4 space-y-3 rounded-lg border border-dashed border-gray-300 bg-gray-50 p-3",onSubmit:ee,children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-700",children:"Add Subtodo"})}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)("input",{type:"text",value:w,onChange:e=>N(e.target.value),placeholder:"Subtodo title",className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30"}),(0,a.jsx)("textarea",{value:j,onChange:e=>D(e.target.value),placeholder:"Optional description",className:"rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/30",rows:2})]}),O&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:O}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:S,className:"inline-flex items-center justify-center rounded-md bg-brand-500 px-3 py-1 text-sm font-semibold text-white transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:S?"Adding...":"Add Subtodo"})})]})]})]})]})})}let b="todo_offline_queue_v1",h=()=>{try{let e=window.localStorage.getItem(b);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("Failed to read offline queue",e),[]}},f=e=>{if(!e.length){window.localStorage.removeItem(b);return}window.localStorage.setItem(b,JSON.stringify(e))},y=e=>{let t=h();t.push(e),f(t)},v=()=>{let e=h();return f([]),e},w=e=>{f(e)};var N=r(9079);let j={title:"",description:"",startDate:"",endDate:"",image:null},D="todo_cached_todos_v1",S=[{id:"TODO",title:"Todo",accentClass:"text-gray-500"},{id:"IN_PROGRESS",title:"In Progress",accentClass:"text-yellow-600"},{id:"DONE",title:"Done",accentClass:"text-green-600"}],E=e=>e.map(e=>({...e,subtodos:e.subtodos?E(e.subtodos):e.subtodos})),O=(e,t)=>e.filter(e=>e.id!==t).map(e=>({...e,subtodos:e.subtodos?O(e.subtodos,t):e.subtodos})),k=(e,t,r)=>e.map(e=>{var a,s;return e.id===t?{...e,subtodos:[...null!==(s=e.subtodos)&&void 0!==s?s:[],r]}:(null===(a=e.subtodos)||void 0===a?void 0:a.length)?{...e,subtodos:k(e.subtodos,t,r)}:e}),C=(e,t)=>e.map(e=>{var r;return e.id===t.id?t:(null===(r=e.subtodos)||void 0===r?void 0:r.length)?{...e,subtodos:C(e.subtodos,t)}:e}),T=(e,t,r)=>e.map(e=>{var a,s;if(e.id===t){let t="DONE"===r?null===(s=e.subtodos)||void 0===s?void 0:s.map(e=>({...e,status:"DONE"})):e.subtodos;return{...e,status:r,subtodos:t}}return(null===(a=e.subtodos)||void 0===a?void 0:a.some(e=>e.id===t))?{...e,subtodos:e.subtodos.map(e=>e.id===t?{...e,status:r}:e)}:e}),I=(e,t,r)=>e.map(e=>{var a;return e.id===t?{...e,...r}:(null===(a=e.subtodos)||void 0===a?void 0:a.length)?{...e,subtodos:I(e.subtodos,t,r)}:e}),A="todo_status_queue_v1",_=e=>!navigator.onLine||e instanceof TypeError&&"Failed to fetch"===e.message,P=(e,t)=>{let r=new FormData;if(void 0!==e.title&&r.append("title",e.title),void 0!==e.description){var a;r.append("description",null!==(a=e.description)&&void 0!==a?a:"")}return e.clearStartDate?r.append("startDate",""):e.startDate&&r.append("startDate",e.startDate),e.clearEndDate?r.append("endDate",""):e.endDate&&r.append("endDate",e.endDate),e.image&&r.append("image",e.image),e.status&&r.append("status",e.status),void 0!==t&&r.append("parentId",String(t)),r},U=e=>{var t,r,a,s,l,n;return{id:"number"==typeof e.id?e.id:Number(e.id),title:null!==(t=e.title)&&void 0!==t?t:"Untitled",description:"string"==typeof e.description&&e.description.trim().length>0?e.description:null,status:null!==(r=e.status)&&void 0!==r?r:"TODO",parentId:"number"==typeof e.parentId?e.parentId:null!==(a=e.parentId)&&void 0!==a?a:null,imageUrl:null!==(s=e.imageUrl)&&void 0!==s?s:void 0,startDate:null!==(l=e.startDate)&&void 0!==l?l:void 0,endDate:null!==(n=e.endDate)&&void 0!==n?n:void 0,createdAt:"string"==typeof e.createdAt?e.createdAt:new Date().toISOString(),updatedAt:"string"==typeof e.updatedAt?e.updatedAt:new Date().toISOString(),subtodos:Array.isArray(e.subtodos)?e.subtodos.map(e=>U(e)):[],timeline:Array.isArray(e.timeline)?e.timeline.map(e=>{var t;return{id:e.id,type:e.type,message:e.message,actorUserId:"number"==typeof e.actorUserId?e.actorUserId:null!==(t=e.actorUserId)&&void 0!==t?t:null,createdAt:"string"==typeof e.createdAt?e.createdAt:new Date(e.createdAt).toISOString()}}):[]}},L=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()};function F(){let e=(0,n.useRouter)(),{isAuthenticated:t,isLoading:r,user:d,logout:c}=(0,N.a)(),[u,m]=(0,s.useState)([]),p=(0,s.useRef)([]),b=(0,s.useRef)(null),h=(0,s.useRef)(!1),[f,F]=(0,s.useState)(!0),[R,J]=(0,s.useState)(null),[B,V]=(0,s.useState)(j),[q,M]=(0,s.useState)(null),[z,G]=(0,s.useState)(!1),[W,X]=(0,s.useState)(null),[Y,H]=(0,s.useState)(!1),[K,Z]=(0,s.useState)(null),[Q,$]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(null),er=(0,s.useRef)(null),ea=(0,s.useCallback)(()=>{if("undefined"==typeof document||er.current)return;let e=document.documentElement,t=document.body;er.current={htmlOverflow:e.style.overflow,htmlTouchAction:e.style.getPropertyValue("touch-action"),htmlOverscrollBehavior:e.style.getPropertyValue("overscroll-behavior"),bodyOverflow:t.style.overflow,bodyTouchAction:t.style.getPropertyValue("touch-action"),bodyOverscrollBehavior:t.style.getPropertyValue("overscroll-behavior")},e.style.overflow="hidden",e.style.setProperty("touch-action","none"),e.style.setProperty("overscroll-behavior","none"),t.style.overflow="hidden",t.style.setProperty("touch-action","none"),t.style.setProperty("overscroll-behavior","none")},[]),es=(0,s.useCallback)(()=>{if("undefined"==typeof document)return;let e=er.current;if(!e)return;let t=document.documentElement,r=document.body;t.style.overflow=e.htmlOverflow,e.htmlTouchAction?t.style.setProperty("touch-action",e.htmlTouchAction):t.style.removeProperty("touch-action"),e.htmlOverscrollBehavior?t.style.setProperty("overscroll-behavior",e.htmlOverscrollBehavior):t.style.removeProperty("overscroll-behavior"),r.style.overflow=e.bodyOverflow,e.bodyTouchAction?r.style.setProperty("touch-action",e.bodyTouchAction):r.style.removeProperty("touch-action"),e.bodyOverscrollBehavior?r.style.setProperty("overscroll-behavior",e.bodyOverscrollBehavior):r.style.removeProperty("overscroll-behavior"),er.current=null},[]);(0,s.useEffect)(()=>{r||t||e.replace("/login")},[r,t,e]);let el=(0,s.useCallback)(e=>{window.localStorage.setItem(D,JSON.stringify(e))},[]),en=(0,s.useCallback)(e=>{m(t=>{let r=e(t);return el(r),r})},[el]),eo=(0,s.useCallback)(async()=>{if(t){F(!0);try{let e=(await (0,o.zB)()).map(e=>U(e));m(e),el(e),J(null)}catch(r){if((null==r?void 0:r.status)===401){c(),await e.replace("/login");return}let t=window.localStorage.getItem(D);if(t)try{let e=JSON.parse(t);m(e),J("Offline mode: showing cached todos.")}catch(e){J(r instanceof Error?r.message:"Failed to load todos")}else J(r instanceof Error?r.message:"Failed to load todos")}finally{F(!1)}}},[t,el,c,e]),ei=(0,s.useCallback)(async()=>{if(!t||!navigator.onLine)return;let e=v();if(!e.length)return;let r=!1,a=[];for(let t=0;t<e.length;t++){let l=e[t];try{if("createTodo"===l.type){var s;let e=P(l.payload.values,null!==(s=l.payload.parentId)&&void 0!==s?s:void 0);await (0,o.JV)(e)}else"updateStatus"===l.type&&await (0,o.Os)(l.payload.id,l.payload.status);r=!0}catch(r){a.push(l,...e.slice(t+1));break}}w(a),r&&await eo()},[t,eo]);(0,s.useEffect)(()=>{eo()},[eo]),(0,s.useEffect)(()=>{ei();let e=()=>{ei()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[ei]),(0,s.useEffect)(()=>{let e=e=>{e.preventDefault(),Z(e),$(!0),et(null)},t=()=>{Z(null),$(!1),et("App installed! You can launch it from your home screen.")};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[]);let ed=(0,s.useCallback)(async()=>{if(K)try{et(null),await K.prompt();let e=await K.userChoice;Z(null),$(!1),"accepted"===e.outcome?et("Install started. Check your device to finish adding the app."):et("Install dismissed. You can try again later.")}catch(e){et("Install prompt failed. Please try again later."),Z(null),$(!1)}},[K]);(0,s.useEffect)(()=>()=>{es()},[es]);let ec=(0,l.Dy)((0,l.VT)(l.we,{activationConstraint:{distance:8}}));(0,s.useEffect)(()=>{p.current=E(u)},[u]),(0,s.useMemo)(()=>({...l.RJ,duration:250,easing:"cubic-bezier(0.22, 1, 0.36, 1)"}),[]);let eu=(0,s.useRef)([]),em=(0,s.useCallback)(()=>{let e=eu.current.map(e=>{let{todoId:t,status:r}=e;return{todoId:t,status:r}});window.localStorage.setItem(A,JSON.stringify(e))},[]);(0,s.useEffect)(()=>{if(t&&!f&&!h.current){h.current=!0;try{let e=window.localStorage.getItem(A);if(!e)return;let t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return;let r=E(p.current),a=[];t.forEach(e=>{let{todoId:t,status:s}=e;a.push({todoId:t,status:s,snapshot:E(r)}),r=T(r,t,s)}),eu.current=a,en(()=>r)}catch(e){window.localStorage.removeItem(A)}}},[t,f,en]),(0,s.useEffect)(()=>{if(!t)return;let e=(0,o.bW)();if(!e)return;let r=!1,a=null,s=()=>{if(r)return;b.current&&(b.current.close(),b.current=null);let t=new URL("/api/todos/stream",o.T5);t.searchParams.set("token",e);let l=new EventSource(t.toString());b.current=l,l.onmessage=e=>{if(e.data)try{let t=JSON.parse(e.data);if(!t||t.userId!==(null==d?void 0:d.id))return;switch(t.type){case"create":case"update":case"status_single":case"status_batch":if(Array.isArray(t.todos)){let e=t.todos.map(e=>U(e));en(t=>{let r=E(t);for(let t of e)r=C(r,t);return r})}break;case"delete":Array.isArray(t.removedIds)&&en(e=>{var r;let a=E(e);for(let e of null!==(r=t.removedIds)&&void 0!==r?r:[])a=O(a,e);return a})}}catch(e){}},l.onerror=()=>{l.close(),r||(a=setTimeout(s,3e3))}};return s(),()=>{r=!0,a&&clearTimeout(a),b.current&&(b.current.close(),b.current=null)}},[t,en,null==d?void 0:d.id]);let ep=async e=>{var t,r,a,s;if(e.preventDefault(),!B.title.trim()){M("Title is required");return}G(!0),M(null);let l={title:B.title.trim(),description:B.description.trim()?B.description.trim():null,startDate:B.startDate||null,endDate:B.endDate||null,image:B.image,clearStartDate:""===B.startDate,clearEndDate:""===B.endDate},n=-1*Date.now(),i=new Date().toISOString(),d={id:n,title:l.title,description:null!==(t=l.description)&&void 0!==t?t:null,startDate:null!==(r=l.startDate)&&void 0!==r?r:void 0,endDate:null!==(a=l.endDate)&&void 0!==a?a:void 0,status:null!==(s=l.status)&&void 0!==s?s:"TODO",parentId:null,imageUrl:void 0,createdAt:i,updatedAt:i,subtodos:[],timeline:[]};en(e=>[d,...e]);let c=P(l);try{let e=await (0,o.JV)(c),t=U(e);en(e=>{let r=O(e,n);return[t,...r]}),V(j),M(null),H(!1),eo()}catch(e){if(_(e)){if(B.image){en(e=>O(e,n)),M("Image uploads require an internet connection."),G(!1);return}y({type:"createTodo",payload:{values:{title:l.title,description:l.description,startDate:l.startDate,endDate:l.endDate,status:"TODO"},parentId:null}}),V(j),M(null),H(!1),J("Offline mode: todo will sync when you're back online.")}else en(e=>O(e,n)),M(e instanceof Error?e.message:"Failed to create todo")}finally{G(!1)}},ex=(0,s.useCallback)(async(e,t)=>{var r,a;let s={title:t.title.trim(),description:(null===(r=t.description)||void 0===r?void 0:r.trim())?t.description.trim():null,status:"TODO"},l=-1*Date.now(),n=new Date().toISOString(),i={id:l,title:s.title,description:null!==(a=s.description)&&void 0!==a?a:null,startDate:void 0,endDate:void 0,status:"TODO",parentId:e.id,imageUrl:void 0,createdAt:n,updatedAt:n,subtodos:[],timeline:[]};en(t=>k(t,e.id,i));try{let t=P(s,e.id),r=await (0,o.JV)(t),a=U(r);en(e=>{let t=O(e,l);return a.parentId?k(t,a.parentId,a):[a,...t]}),eo()}catch(t){_(t)?(y({type:"createTodo",payload:{values:s,parentId:e.id}}),J("Offline mode: subtodo will sync when you're back online.")):(en(e=>O(e,l)),J(t instanceof Error?t.message:"Failed to create subtodo"))}},[eo,en]),eg=(0,s.useCallback)((e,t)=>{en(r=>T(r,e,t))},[en]),eb=(0,s.useCallback)((e,t,r)=>{let a=eu.current.find(t=>t.todoId===e),s=a?a.snapshot:r;eu.current=eu.current.filter(t=>t.todoId!==e),eu.current.push({todoId:e,status:t,snapshot:s}),em()},[em]),eh=(0,s.useCallback)(async function(){let{keepalive:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===eu.current.length)return!0;let r=eu.current.map(e=>{let{todoId:t,status:r}=e;return{id:t,status:r}});try{await (0,o.dn)(r,{keepalive:t});let e=r.map(e=>e.id);return eu.current=[],em(),en(t=>e.reduce((e,t)=>T(e,t,"TODO"),t)),t||J(null),!0}catch(r){return t||((null==r?void 0:r.status)===401?(eu.current=[],em(),await c(),await e.replace("/login")):J(r instanceof Error?r.message:"Failed to sync pending status updates")),!1}},[c,em,e,en]),ef=(0,s.useCallback)(async(e,t)=>{if(e.status===t)return;if(e.id<0){J("Please wait for this todo to sync before updating its status.");return}J(null);let r=E(p.current);eg(e.id,t),eb(e.id,t,r),"undefined"==typeof navigator||navigator.onLine||(y({type:"updateStatus",payload:{id:e.id,status:t}}),J("Offline mode: status change queued for sync."))},[eg,eb]),ey=(0,s.useCallback)(async e=>{let t=E(p.current);eu.current=eu.current.filter(t=>t.todoId!==e.id),em(),en(t=>O(t,e.id));try{await (0,o.aS)(e.id),J(null),X(t=>t===e.id?null:t)}catch(r){en(()=>t);let e=r instanceof Error?r.message:"Failed to delete todo";throw J(e),r instanceof Error?r:Error(e)}},[o.aS,em,en]),ev=(0,s.useCallback)(async e=>{let t=E(p.current);eu.current=eu.current.filter(t=>t.todoId!==e.id),em(),en(t=>O(t,e.id));try{await (0,o.aS)(e.id),J(null)}catch(r){en(()=>t);let e=r instanceof Error?r.message:"Failed to delete subtodo";throw J(e),r instanceof Error?r:Error(e)}},[o.aS,em,en]),ew=(0,s.useCallback)(async(e,t)=>{let r=E(p.current);en(r=>I(r,e.id,{title:t.title,description:t.description}));try{let r=await (0,o.CU)(e.id,{title:t.title,description:t.description}),a=U(r);en(e=>C(e,a)),J(null)}catch(t){let e=t instanceof Error?t.message:"Failed to update todo";throw J(e),en(()=>r),t instanceof Error?t:Error(e)}},[J,o.CU,en]),eN=(0,s.useCallback)(async(e,t)=>{let r=E(p.current),a={startDate:L(t.startDate),endDate:L(t.endDate)};en(r=>I(r,e.id,{startDate:L(t.startDate),endDate:L(t.endDate)}));try{let t=await (0,o.CU)(e.id,a),r=U(t);en(e=>C(e,r)),J(null)}catch(t){let e=t instanceof Error?t.message:"Failed to update timeline";throw J(e),en(()=>r),t instanceof Error?t:Error(e)}},[o.CU,en]);(0,s.useEffect)(()=>{let e=()=>{0!==eu.current.length&&eh({keepalive:!0})},t=()=>{"hidden"===document.visibilityState&&e()};return window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("pagehide",e),document.removeEventListener("visibilitychange",t)}},[eh]),(0,s.useEffect)(()=>{let e=()=>{eh()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[eh]),(0,s.useEffect)(()=>{let e=()=>{eh()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[eh]);let ej=(0,s.useCallback)(async(e,t)=>{await ef(e,t?"DONE":"TODO")},[ef]),eD=(0,s.useCallback)(()=>{ea()},[ea]),eS=(0,s.useCallback)(()=>{es()},[es]);(0,s.useEffect)(()=>()=>{b.current&&(b.current.close(),b.current=null)},[]);let eE=(0,s.useCallback)(async e=>{var t;es();let{active:r,over:a}=e;if(!a)return;let s=null===(t=r.data.current)||void 0===t?void 0:t.todo,l=a.id;if(s&&l&&s.status!==l)try{await ef(s,l)}catch(e){}},[ef,es]),eO=(0,s.useMemo)(()=>{let e={TODO:[],IN_PROGRESS:[],DONE:[]};for(let a of u){var t,r;let s=null!==(t=a.status)&&void 0!==t?t:"TODO";(null!==(r=e[s])&&void 0!==r?r:e.TODO).push({...a,status:s})}return e},[u]),ek=(0,s.useMemo)(()=>{var e;return null!=W&&null!==(e=u.find(e=>e.id===W))&&void 0!==e?e:null},[u,W]),eC=(0,s.useMemo)(()=>f?"Loading your board...":0===u.length?"Start planning with your first todo":"Todo Board",[f,u.length]);return r?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 text-sm text-gray-500",children:"Loading your workspace..."}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"mx-auto max-w-6xl px-4 py-8",children:[(0,a.jsxs)("nav",{className:"mb-6 flex items-center justify-between rounded-2xl bg-white/80 px-6 py-4 shadow",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-widest text-brand-500",children:"Todo App"}),(0,a.jsxs)("h1",{className:"text-lg font-semibold text-gray-900",children:["Hello, ",(null==d?void 0:d.name)||(null==d?void 0:d.email)]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[Q&&(0,a.jsx)("button",{type:"button",onClick:ed,className:"rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold text-white shadow transition hover:bg-brand-500/90",children:"Install app"}),(0,a.jsx)("button",{type:"button",onClick:()=>c(),className:"rounded-full border border-gray-200 px-4 py-2 text-xs font-medium text-gray-600 transition hover:border-brand-500 hover:text-brand-500",children:"Log out"})]})]}),(0,a.jsxs)("header",{className:"mb-8 text-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900 md:text-4xl",children:eC}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Organise todos, collaborate with subtasks, and track progress with timelines."}),ee&&(0,a.jsx)("p",{className:"mt-3 text-sm text-brand-500",children:ee})]}),R&&(0,a.jsx)("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:R}),(0,a.jsx)(l.LB,{sensors:ec,collisionDetection:l.ey,onDragStart:eD,onDragCancel:eS,onDragEnd:eE,children:(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:S.map(e=>(0,a.jsxs)(i,{id:e.id,title:e.title,subtitle:"".concat(eO[e.id].length," tasks"),accentClass:e.accentClass,children:["TODO"===e.id&&(0,a.jsx)("button",{type:"button",onClick:()=>H(!0),className:"flex w-full items-center justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 py-10 text-sm font-medium text-gray-500 transition hover:border-brand-500 hover:text-brand-500",children:"+ Add new todo"}),eO[e.id].map(e=>(0,a.jsx)(x,{todo:e,onUpdateStatus:ef,onViewDetails:e=>X(e.id),onToggleSubTodo:ej,onDeleteTodo:ey,onDeleteSubTodo:ev},e.id))]},e.id))})})]}),ek&&(0,a.jsx)(g,{todo:ek,onClose:()=>X(null),onUpdateStatus:ef,onCreateSubTodo:ex,onToggleSubTodo:ej,onDeleteTodo:ey,onDeleteSubTodo:ev,onUpdateDetails:ew,onUpdateTimeline:eN}),Y&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-xl overflow-hidden rounded-2xl bg-white shadow-xl",children:[(0,a.jsx)("header",{className:"border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-gray-400",children:"New Todo"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Create a todo"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{H(!1),V(j),M(null)},className:"rounded-full border border-gray-200 px-3 py-1 text-xs text-gray-500 transition hover:bg-gray-100",children:"Close"})]})}),(0,a.jsxs)("form",{onSubmit:ep,className:"space-y-4 px-6 py-5",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-title",children:"Title"}),(0,a.jsx)("input",{id:"modal-title",type:"text",value:B.title,onChange:e=>V(t=>({...t,title:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",placeholder:"Kick-off meeting"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-description",children:"Description"}),(0,a.jsx)("textarea",{id:"modal-description",value:B.description,onChange:e=>V(t=>({...t,description:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30",rows:3,placeholder:"Context, goals, links..."})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-start",children:"Start date"}),(0,a.jsx)("input",{id:"modal-start",type:"date",value:B.startDate,onChange:e=>V(t=>({...t,startDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-end",children:"End date"}),(0,a.jsx)("input",{id:"modal-end",type:"date",value:B.endDate,onChange:e=>V(t=>({...t,endDate:e.target.value})),className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2 text-sm focus:border-brand-500 focus:bg-white focus:outline-none focus:ring-2 focus:ring-brand-500/30"})]})]}),(0,a.jsxs)("div",{className:"grid gap-1",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-gray-800",htmlFor:"modal-image",children:"Reference image (optional)"}),(0,a.jsx)("input",{id:"modal-image",type:"file",accept:"image/*",onChange:e=>V(t=>{var r,a;return{...t,image:null!==(a=null===(r=e.target.files)||void 0===r?void 0:r[0])&&void 0!==a?a:null}}),className:"text-sm"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Attach mockups, briefs, or supporting screenshots if you have them."})]}),q&&(0,a.jsx)("p",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:q}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>(H(!1),V(j),M(null)),className:"rounded-full border border-gray-200 px-4 py-2 text-sm text-gray-600 transition hover:bg-gray-100",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:z,className:"inline-flex items-center rounded-full bg-brand-500 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-brand-500/20 transition hover:bg-brand-500/90 disabled:cursor-not-allowed disabled:opacity-70",children:z?"Creating...":"Create todo"})]})]})]})})]}):null}}},function(e){e.O(0,[675,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);